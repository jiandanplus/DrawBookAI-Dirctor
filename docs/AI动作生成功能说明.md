# AI动作生成功能说明

## 功能概述

在StageDirector的叙事动作编辑弹框中，新增了"AI动作生成"功能。该功能会调用chat模型，根据当前镜头的首帧和尾帧信息，结合经过验证的高质量动作提示词，自动生成适合当前场景的动作描述。

## 功能特点

### 1. 智能场景分析
- 自动读取当前镜头的首帧和尾帧提示词
- 考虑镜头运动类型（推拉摇移等）
- 基于场景上下文生成合理的动作衔接

### 2. 参考优质案例
AI会参考以下类型的高质量动作提示词：
- **特效魔法戏**：强调视觉冲击和能量表现
- **打斗戏**：参考李小龙、成龙级别的动作设计
- **蓄力攻击**：展现震撼感和压迫感
- **魔法展开**：多镜头切换，特写与全景结合
- **快速移动**：模糊拖影特效，速度感表现
- **能量爆发**：雷暴、光芒等特效描写

### 3. 输出内容
AI生成的动作建议包含：
- 完整的动作场景描述
- 关键的镜头切换和运镜说明
- 视觉特效和情感氛围描述
- 电影级的运镜语言

## 使用方法

### 步骤1：打开编辑弹框
1. 在StageDirector工作台选择一个镜头
2. 点击"编辑叙事动作"按钮

### 步骤2：触发AI生成
1. 在编辑弹框顶部，找到"AI生成动作建议"按钮
2. 点击按钮，AI将开始分析并生成动作

### 步骤3：查看和编辑
1. AI生成完成后，内容会自动填充到文本框
2. 可以根据需要进一步编辑和调整
3. 点击"保存"按钮应用修改

## 注意事项

### 前置条件
- 建议先生成或编辑首帧和尾帧的提示词
- 如果两个关键帧都没有提示词，系统会提示先完善这些信息

### 生成时长
- AI生成通常需要5-15秒
- 生成过程中按钮会显示加载状态
- 期间无法编辑文本或进行其他操作

### 内容质量
- AI会自动适配当前场景的视觉风格（实拍、动漫、3D动画等）
- 生成的动作会考虑镜头运动类型，确保运镜合理
- 输出内容具有电影感和画面感，便于理解和执行

## 技术实现

### 核心函数
```typescript
generateActionSuggestion(
  startFramePrompt: string,  // 首帧提示词
  endFramePrompt: string,    // 尾帧提示词
  cameraMovement: string,    // 镜头运动
  model: string = 'gpt-5.1'  // AI模型
): Promise<string>
```

### 提示词工程
- 包含6种高质量动作提示词参考示例
- 详细的任务要求和输出格式说明
- 温度参数设置为0.8，平衡创意和一致性

### UI增强
- EditModal组件新增AI生成按钮
- 渐变色按钮设计，视觉吸引力强
- 加载状态反馈，用户体验良好
- 生成期间禁用编辑，避免冲突

## 效果示例

### 输入
- **首帧**：郑一剑站在天台左侧，背后是夜色笼罩的城市
- **尾帧**：郑一剑出现在曲飞面前，准备出拳
- **镜头运动**：快速横移

### 输出（示例）
```
镜头1：天台左侧中景，郑一剑初始站立，背后是夜色笼罩下灯火闪烁的城市，
圆月高悬。他保持着一种蓄势待发的静态站立姿态，周身氛围沉静。

镜头2：郑一剑消失："模糊拖影"特效与空气扰动，画面瞬间触发"模糊拖影"
特效，身影如被快速拉扯的幻影般，以极快的速度淡化、消失，原地只残留
极其轻微的空气扰动波纹。

镜头3：镜头急速移至曲飞面前，从郑一剑消失的位置，以迅猛的速度横向移动，
画面里天台的栏杆、地面等景物飞速掠过，产生强烈的动态模糊效果。最终镜头
定格在曲飞面前，脸上露出明显的惊讶与警惕。

镜头4：郑一剑突然出现准备出拳，毫无征兆地出现在画面中央，身体大幅度前倾，
呈现出极具张力的准备出拳姿势，右手紧紧握拳，带起的劲风使得衣角大幅度向后
飘动。
```

## 更新日志

### v1.0.0 (2025-12-20)
- ✅ 新增AI动作生成功能
- ✅ 集成6种高质量动作提示词参考
- ✅ EditModal组件增强，支持AI生成按钮
- ✅ StageDirector集成完整的AI生成流程
- ✅ 完善的错误处理和用户提示

## 相关文件

- `services/geminiService.ts` - AI服务层，包含generateActionSuggestion函数
- `components/StageDirector/EditModal.tsx` - 编辑弹框组件
- `components/StageDirector/index.tsx` - 主控制组件
- `docs/动作提示词参考.md` - 高质量动作提示词参考库

## 未来优化方向

1. **更多参考案例**：持续收集和添加更多高质量动作提示词
2. **风格化选项**：允许用户选择特定风格（如武侠、科幻、魔幻等）
3. **多方案生成**：一次生成多个方案供用户选择
4. **历史记录**：保存AI生成的历史记录，方便回顾和复用
5. **个性化学习**：根据用户的编辑习惯优化生成内容
